<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Autentica√ß√£o - Credenciais Espec√≠ficas</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f8fafc;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .status {
            padding: 12px;
            border-radius: 6px;
            margin: 10px 0;
            font-weight: 500;
        }
        .status.success { background: #dcfce7; color: #166534; border: 1px solid #bbf7d0; }
        .status.error { background: #fef2f2; color: #dc2626; border: 1px solid #fecaca; }
        .status.warning { background: #fefce8; color: #ca8a04; border: 1px solid #fde68a; }
        .status.info { background: #eff6ff; color: #2563eb; border: 1px solid #bfdbfe; }
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        button {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }
        .btn-primary {
            background: #3b82f6;
            color: white;
        }
        .btn-primary:hover {
            background: #2563eb;
        }
        .btn-secondary {
            background: #6b7280;
            color: white;
        }
        .btn-secondary:hover {
            background: #4b5563;
        }
        .btn-danger {
            background: #dc2626;
            color: white;
        }
        .btn-danger:hover {
            background: #b91c1c;
        }
        .logs {
            background: #1f2937;
            color: #f9fafb;
            padding: 16px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .form-group {
            margin-bottom: 16px;
        }
        label {
            display: block;
            margin-bottom: 4px;
            font-weight: 500;
            color: #374151;
        }
        input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }
        input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .test-results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }
        .test-card {
            background: #f8fafc;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 16px;
        }
        .test-card h3 {
            margin: 0 0 12px 0;
            color: #1f2937;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîê Teste de Autentica√ß√£o</h1>
            <p>Valida√ß√£o do sistema de login com credenciais espec√≠ficas</p>
        </div>

        <div class="controls">
            <button class="btn-primary" onclick="testLogin()">Testar Login</button>
            <button class="btn-secondary" onclick="testLogout()">Testar Logout</button>
            <button class="btn-secondary" onclick="checkSession()">Verificar Sess√£o</button>
            <button class="btn-danger" onclick="clearLogs()">Limpar Logs</button>
        </div>

        <div class="form-group">
            <label for="email">Email:</label>
            <input type="email" id="email" value="testetotal@teste.com" readonly>
        </div>

        <div class="form-group">
            <label for="password">Password:</label>
            <input type="password" id="password" value="teste14" readonly>
        </div>

        <div id="status"></div>

        <div class="test-results">
            <div class="test-card">
                <h3>Estado da Autentica√ß√£o</h3>
                <div id="auth-state">N√£o verificado</div>
            </div>
            <div class="test-card">
                <h3>Dados do Utilizador</h3>
                <div id="user-data">Nenhum utilizador autenticado</div>
            </div>
            <div class="test-card">
                <h3>Sess√£o Supabase</h3>
                <div id="session-data">Nenhuma sess√£o ativa</div>
            </div>
        </div>

        <div class="container">
            <h3>Logs de Execu√ß√£o</h3>
            <div id="logs" class="logs">Aguardando execu√ß√£o dos testes...
</div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        let logs = [];
        let supabaseClient;

        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString('pt-PT');
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
            logs.push(logEntry);
            
            const logsElement = document.getElementById('logs');
            logsElement.textContent = logs.join('\n');
            logsElement.scrollTop = logsElement.scrollHeight;
            
            console.log(logEntry);
        }

        function updateStatus(message, type) {
            const statusElement = document.getElementById('status');
            statusElement.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function updateAuthState(isAuthenticated, user = null, session = null) {
            document.getElementById('auth-state').textContent = isAuthenticated ? 'Autenticado ‚úÖ' : 'N√£o autenticado ‚ùå';
            
            if (user) {
                document.getElementById('user-data').innerHTML = `
                    <strong>ID:</strong> ${user.id}<br>
                    <strong>Email:</strong> ${user.email}<br>
                    <strong>Criado:</strong> ${new Date(user.created_at).toLocaleString('pt-PT')}
                `;
            } else {
                document.getElementById('user-data').textContent = 'Nenhum utilizador autenticado';
            }
            
            if (session) {
                document.getElementById('session-data').innerHTML = `
                    <strong>Token:</strong> ${session.access_token.substring(0, 20)}...<br>
                    <strong>Expira:</strong> ${new Date(session.expires_at * 1000).toLocaleString('pt-PT')}<br>
                    <strong>Tipo:</strong> ${session.token_type}
                `;
            } else {
                document.getElementById('session-data').textContent = 'Nenhuma sess√£o ativa';
            }
        }

        function initializeSupabase() {
            try {
                const supabaseUrl = 'https://ebitcwrrcumsvqjgrapw.supabase.co';
                const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImViaXRjd3JyY3Vtc3ZxamdyYXB3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI3NjcyMTYsImV4cCI6MjA2ODM0MzIxNn0.hLlTeSD2VzVCjvUSXLYQypXNYqthDx0q1N86aOftfEY';
                
                supabaseClient = supabase.createClient(supabaseUrl, supabaseKey, {
                    auth: {
                        autoRefreshToken: true,
                        persistSession: true,
                        detectSessionInUrl: true
                    }
                });
                
                addLog('Cliente Supabase inicializado com sucesso', 'success');
                
                // Verificar sess√£o inicial
                checkSession();
                
                return true;
            } catch (error) {
                addLog(`Erro ao inicializar Supabase: ${error.message}`, 'error');
                updateStatus('Erro na inicializa√ß√£o do Supabase', 'error');
                return false;
            }
        }

        async function testLogin() {
            if (!supabaseClient) {
                addLog('Cliente Supabase n√£o inicializado', 'error');
                return;
            }

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            addLog(`Iniciando teste de login para: ${email}`, 'info');
            updateStatus('Testando login...', 'info');

            try {
                const { data, error } = await supabaseClient.auth.signInWithPassword({
                    email: email,
                    password: password
                });

                if (error) {
                    addLog(`Erro no login: ${error.message}`, 'error');
                    updateStatus(`Erro no login: ${error.message}`, 'error');
                    updateAuthState(false);
                    return;
                }

                if (data.user && data.session) {
                    addLog('Login realizado com sucesso!', 'success');
                    addLog(`Utilizador autenticado: ${data.user.email}`, 'success');
                    addLog(`Token de sess√£o obtido: ${data.session.access_token.substring(0, 20)}...`, 'success');
                    
                    updateStatus('Login realizado com sucesso!', 'success');
                    updateAuthState(true, data.user, data.session);
                } else {
                    addLog('Login falhou: dados de resposta inv√°lidos', 'error');
                    updateStatus('Login falhou: resposta inv√°lida', 'error');
                    updateAuthState(false);
                }
            } catch (error) {
                addLog(`Exce√ß√£o durante o login: ${error.message}`, 'error');
                updateStatus(`Erro inesperado: ${error.message}`, 'error');
                updateAuthState(false);
            }
        }

        async function testLogout() {
            if (!supabaseClient) {
                addLog('Cliente Supabase n√£o inicializado', 'error');
                return;
            }

            addLog('Iniciando logout...', 'info');
            updateStatus('Fazendo logout...', 'info');

            try {
                const { error } = await supabaseClient.auth.signOut();

                if (error) {
                    addLog(`Erro no logout: ${error.message}`, 'error');
                    updateStatus(`Erro no logout: ${error.message}`, 'error');
                    return;
                }

                addLog('Logout realizado com sucesso!', 'success');
                updateStatus('Logout realizado com sucesso!', 'success');
                updateAuthState(false);
            } catch (error) {
                addLog(`Exce√ß√£o durante o logout: ${error.message}`, 'error');
                updateStatus(`Erro inesperado no logout: ${error.message}`, 'error');
            }
        }

        async function checkSession() {
            if (!supabaseClient) {
                addLog('Cliente Supabase n√£o inicializado', 'error');
                return;
            }

            addLog('Verificando sess√£o atual...', 'info');

            try {
                const { data: { session }, error } = await supabaseClient.auth.getSession();

                if (error) {
                    addLog(`Erro ao verificar sess√£o: ${error.message}`, 'error');
                    updateAuthState(false);
                    return;
                }

                if (session && session.user) {
                    addLog('Sess√£o ativa encontrada!', 'success');
                    addLog(`Utilizador: ${session.user.email}`, 'success');
                    addLog(`Expira em: ${new Date(session.expires_at * 1000).toLocaleString('pt-PT')}`, 'info');
                    
                    updateAuthState(true, session.user, session);
                } else {
                    addLog('Nenhuma sess√£o ativa encontrada', 'warning');
                    updateAuthState(false);
                }
            } catch (error) {
                addLog(`Exce√ß√£o ao verificar sess√£o: ${error.message}`, 'error');
                updateAuthState(false);
            }
        }

        function clearLogs() {
            logs = [];
            document.getElementById('logs').textContent = 'Logs limpos. Aguardando novos testes...';
        }

        // Inicializar quando a p√°gina carregar
        window.addEventListener('load', () => {
            addLog('P√°gina carregada. Inicializando teste de autentica√ß√£o...', 'info');
            initializeSupabase();
        });
    </script>
</body>
</html>